---
title: "5.5 Contract API"
slug: "55-contract-api"
hidden: false
createdAt: "2019-06-21T09:57:13.049Z"
updatedAt: "2019-06-21T09:58:22.484Z"
---
##1. User Guide
The Cocos-BCX smart contract is written in Lua, which is modified on the basis of the official 5.3 version with all syntax retained. On-chain operation functions are added with the function library adjusted to make it more suitable for running on the blockchain.

**1.1. Basic concepts**
**Contract data**
Contract data is divided into user data zone and public data zone. 
◆	User data zone is used to store the data generated by the user after the contract is called. The user data zone is customized by the contract writer;
◆	Public data zone is used to store the data of the contract rules, the contract writer can use the owner assertion (ie: assert(is_owner())) to qualify the caller. The public data zone is recorded by the public_data table, contract writer should pay attention to putting the public data into the public_data object;

**Special objects **
◆	public_data
It is used to record public data zone. The object properties are defined by the contract writer; 
◆	private_data
The user data zone points to the caller of this contract;
◆	read_list
Reading registry of contract data IO. The contract can notify the context to be loaded by writing a read_list table. The default state is: read_list={public_data={}, private_data={}}, and all data of the public_data and private_data partitions are loaded by default;
read_list={public_data={test=true}} reads only the public_data.test data, which takes effect when the read_chain() function is executed;
◆	write_list
Writing registry of contract data IO. The contract can notify the context to be recorded by the chain by writing a write_list table. The default state is: read_list={public_data={}, private_data={}}, and all data of the public_data and private_data partitions are recorded by default;
write_list={public_data={test=true}} writes only the public_data.test data, which takes effect when the write_chain() function is executed. (true/false) is the value of each path of write_list, where true indicates that if it exists, it will be updated, if it does not exist, it will be created, and false indicates that if it exists, it will be cleared; 
◆	contract_base_info
The basic information used to store the contract. Modifications to the object within the contract will not be recorded. Object properties: name (contract name), id (contract id), owner (contract owner id), caller (current caller id), creation_date (contract writing time), contract_authority (contract requires to be signed by authorization);

##1.2. Note
**Contract session recovery mechanism does not include recovery of runtime code **
That is: the lambda expression is only valid in the current function context, including the dynamic attribute function of table and metatable; 
**Uniform contract application layer table data structure, disable metatable **
Reasons:
◆	The lambda functions are common in metatable, while the runtime code cannot be restored;
◆	The speed of metatable data structure IO is slower than that of table data structure

## 2. Basic module and extensions
**2.1. Basic module**
The contract sandbox can be controlled to support the basic module according to the configuration of Contract No. 0. The subsequent No. 0 basic support contract will be managed by the Committee.
**2.2. Extensions**
**2.2.1. CJSON module**
CJSON module is often used to parse incoming function structured parameters. 
The current contract ABI has accepted the parameters of the external table data structure, but continues to retain the CJSON module to pass the object and serialization of the object as a string. 
Call method:

[block:code]
{
  "codes": [
    {
      "code": "cjson.function_name(*)",
      "language": "lua"
    }
  ]
}
[/block]

[block:code]
{
  "codes": [
    {
      "code": "table decode(string jsonstr)",
      "language": "lua"
    }
  ]
}
[/block]

[block:code]
{
  "codes": [
    {
      "code": "string encode(table tal)",
      "language": "lua"
    }
  ]
}
[/block]
## 3. Contract-Chain Interaction Module - Static Function
The static function of the chain interaction module can be called directly in the contract with the function name.
**get_account_contract_data**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "table get_account_contract_data(string name_or_id,table private_data_register_list)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Read the user data of certain user's corresponding path 
**Return value**
Return the user data of a table structure. If there is no data specified in the path, the corresponding table branch will be empty. 
**Example**
nico_data=get_account_contract_data('nicotest',{nicodata0={nicodata1=true}) 
To read the nicodata0.nicodata1 data in the nicotest account in this contract, if nicotest is the contract caller: nico_data should be the same as private_data.nicodata0.nicodata1.

## 4. Contract-Chain Interaction Module - Dynamic Functions
The dynamic functions of the chain interaction module need to be called in the contract according to the "chainhelper: function name (parameter...)".

**4.1. hash256**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "string hash256(string source)",
      "language": "lua"
    }
  ]
}
[/block]
**Return value**
Return hash256 string 
**Parameter**
Source: the source data that needs to be computed

**4.2. hash512**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "string hash512(string source)",
      "language": "lua"
    }
  ]
}
[/block]
**Return value**
Return hash512 string 
**Parameter**
Source: the source data that needs to be computed

**4.3. create_nh_asset**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void create_nh_asset(string owner_id_or_name, string symbol, string world_view, string base_describe, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
To create a non-homogeneous item, the contract owner must have the corresponding creation permission.
**Parameters**
name_or_id: Owner of the new item
symbol: Circulation-limited homogeneous asset symbol (reserved), for example,​ COCOS
world_view: Worldview
base_describe: Basic description
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.4. adjust_lock_asset**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void adjust_lock_asset(string symbol_or_id, int64_t amount)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Adjust the assets that the contract owner has locked in this contract. 
**Parameters**
symbol_or_id: Asset ID or symbol that needs to be adjusted
amount: The number with precision can be negative (which means to reduce the locking amount), the locking amount after adjustment should be greater than 0, but less than the maximum amount of the corresponding asset of the contract owner.

**4.5. read_chain**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void read_chain()",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Reading of the contract data IO, which corresponds to the read_list registry.

**4.6. write_chain**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void write_chain()",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Writing of the contract data IO, which corresponds to the write_list registry.

**4.7. get_account_balancen**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "int get_account_balance(string account_name_or_id,string asset_symbol_or_id)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Query the balance of the homogeneous assets of the specified account 
**Return value**
Balance
**Parameters**
account_name_or_id: Account name or id to be queried
asset_symbol_or_id: Asset symbol or id to be queried

**4.8. transfer_from_caller**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_from_caller(string to, uint token, string symbol,bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer the asset from the contract caller to the account to, the amount is: token, token symbol: symbol 
**Parameters**
to: Account id of the recipient
token: The amount should be greater than 0 and less than the maximum range of lua number
symbol: Asset symbol
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.9. transfer_from_owner**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_from_owner(string to, uint token, string symbol,bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer the asset from the contract caller to the account to, the amount is: token, token symbol: symbol 
**Parameters**
to: Account id of the recipient
token: The amount should be greater than 0 and less than the maximum range of lua number
symbol: Asset symbol
enable_logger: Identify whether the relevant impact,​ in the contract result

**4.10. make_memo**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void make_memo (string to, string key, string value,bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Encrypted data constructor. 
**Parameters**
to: Specified message decryptor account id
key: Password seed provided by the ECC shared key
value: Encrypted content
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.11. transfer_nht_from_caller**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_nht_from_caller(string to, string token_hash_or_id,bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer non-homogeneous assets from the contract caller to the account to 
**Parameters**
to: Account id of the recipient
token_hash_or_id: The specified non-homogeneous token hash value or id 
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.12. transfer_nht_from_owner**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_nht_from_owner(string to, string token_hash_or_id,bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer non-homogeneous assets from the contract owner to the account to
**Parameters**
to: Account id of the recipient
token_hash_or_id: The specified non-homogeneous token hash value or id 
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.13. change_nht_active_by_owner**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void change_nht_active_by_owner (string beneficiary_account, string token_hash_or_id, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Modify the use right of non-homogeneous assets, the contract owner must have the specified non-homogeneous token proxy authority or have both the ownership and the use right. 
**Parameters**
beneficiary_account: Account name or account ID to be assigned the right to use the ​non-homogeneous token
token_hash_or_id: The specified non-homogeneous token hash value or id 
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.14. transfer_nht_active_from_caller**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_nht_active_from_caller( string to, string token_hash_or_id, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer the use right of the non-homogenous token from the contract caller, the caller must have the specified non-homogeneous token proxy authority or both the ownership and the use right. 
**Parameters**
to: Account name or account ID to be assigned the right to use the non-homogeneous token
token_hash_or_id: The specified non-homogeneous token hash value or id 
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.15. transfer_nht_authority_from_owner**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_nht_authority_from_owner(string to, string token_hash_or_id, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer non-homogeneous token proxy control from the contract owner, the contract owner must have the specified non-homogeneous token proxy authority .
**Parameters**
to: Account name or account ID to be assigned the proxy control over the non-homogeneous token
token_hash_or_id: The specified non-homogeneous token hash value or id 
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.16. transfer_nht_authority_from_caller**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void transfer_nht_authority_from_caller( string to, string token_hash_or_id, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Transfer non-homogeneous token proxy control from the contract owner, the caller must have the specified non-homogeneous token proxy authority 
**Parameters**
to: Account name or account ID to be assigned the proxy control over the non-homogeneous token
token_hash_or_id: The specified non-homogeneous token hash value or id 
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.17. set_nht_limit_list**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void set_nht_limit_list( string token_hash_or_id, string contract_name_or_ids, bool limit_type, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Set the read and write permissions for the extension field (contract data field) of the specified item. The caller must have the ownership and the use right of the specified non-homogeneous token. 
**Parameters**
token_hash_or_id: The specified non-homogeneous token hash value or id 
contract_name_or_ids: Multiple data fields (contracts) are split with ","
limit_type: The result of true represents a whitelist, where specified data field will be allowed to write; while the false represents a blacklist, where the specified data field will not be allowed to write.
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.18. relate_nh_asset**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void relate_nh_asset(string parent_token_hash_or_id, string child_token_hash_or_id, bool relate, bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Link two non-homogeneous assets. 
**Parameters**
parent_token_hash_or_id: The hash or id of the specified parent non-homogeneous asset
child_token_hash_or_id: The hash or id of the specified child non-homogeneous asset
relate: Whether to relate
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.19. random**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "int random()",
      "language": "lua"
    }
  ]
}
[/block]
**Description*
Generate an internal random number. 
**Return value**
Radom number result

**4.20. is_owner**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "bool is_owner()",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Determine if the contract caller is the owner for contract assertions. 
**Return value**
The determination

**4.21. nht_describe_change**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void nht_describe_change(string nht_hash_or_id, string key, string value,bool enable_logger)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Modify the zone data description of a non-homogeneous token. Only the zone corresponding to the contract can be modified. 
**Parameters**
token_hash_or_id: The hash or id of the specified child non-homogeneous asset
key: Key name of the zone data
value: Value corresponding to the zone data key
enable_logger: Identify whether the relevant impact is recorded in the contract result

**4.22. set_permissions_flag**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void set_permissions_flag(bool flag)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Set contract authority verification ID to enable or disable contract signing requirements. Only the corresponding trusted execution environment has contract authority. In the trusted execution environment, the user signature and the contract signature will be completed simultaneously when the user calls the contract. 
**Parameters**
flag: Whether to enable signature requirements

**4.23. change_contract_authority**

**Prototype**
[block:code]
{
  "codes": [
    {
      "code": "void change_contract_authority(string publickey)",
      "language": "lua"
    }
  ]
}
[/block]
**Description**
Modify contract verification permission 
**Modify contract verification permission **
publickey: the public key corresponding to the verification permission

##5. Functions of Smart Contract

**5.1. Hello World (Log output)**
[block:code]
{
  "codes": [
    {
      "code": "function logtest()\n    chainhelper:log('hello world')\n    chainhelper:log(date('%Y-%m-%dT%H:%M:%S', chainhelper:time()))\nend\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.2. Get the time of the chain**
[block:code]
{
  "codes": [
    {
      "code": "function timetest() \n    public_data.time=date('%Y-%m-%dT%H:%M:%S', chainhelper:time()) \n    write_list={public_data={time=true}} \n    chainhelper:write_chain() \nend\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.3. Transfer**
[block:code]
{
  "codes": [
    {
      "code": "function transfer(amount,symbol,islog) \n    chainhelper:transfer_from_caller(contract_base_info.owner,amount,symbol,islog) --Transfer homogenous assets from the contract owner to the account\n    chainhelper:transfer_from_owner(contract_base_info.caller,amount,symbol,islog) --Transfer homogenous assets from the contract owner to the account\nend\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.4. Asset lock configuration**
[block:code]
{
  "codes": [
    {
      "code": "function init()\n    assert(chainhelper:is_owner(),'chainhelper:is_owner()')\n    read_list={public_data={is_init=true}}\n    chainhelper:read_chain()\n    assert(public_data.is_init==nil,'public_data.is_init==nil')\n    public_data.locked=0\n    public_data.is_init=true\n    chainhelper:write_chain()\nend\n\nfunction pay_with_lock(amount,symbol)\n    assert(amount>0,'amount > 0')\n    read_list={public_data={}}\n    chainhelper:read_chain()\n    assert(public_data.locked+amount>public_data.locked,'public_data.locked+amount>public_data.locked')\n    public_data.locked=public_data.locked+amount;  --[[Adjust lock record]]\n  assert(public_data.locked<=chainhelper:number_max(),'public_data.locked<=chainhelper:number_max()')\n    chainhelper:transfer_from_caller(contract_base_info.owner,amount,symbol,true)\n--[[Transfer the tokens in]]\n    chainhelper:adjust_lock_asset(symbol,amount)  --[[Lock the tokens]]\n    write_list=read_list\n    chainhelper:write_chain()\nend    \n\nfunction adjustment_lock_and_transfer(to,amount,symbol)\n    assert(chainhelper:is_owner(),'chainhelper:is_owner()')\n    read_list={public_data={}}\n    chainhelper:read_chain()\n    assert(amount > 0 and public_data.locked – amount >= 0, 'amount>0 and public_data.locked-amount>=0')\n    public_data.locked=public_data.locked-amount  --[[Adjust lock record]]\n    chainhelper:adjust_lock_asset(symbol,-amount)      --[[Unlock the tokens]]\n    if(to~=contract_base_info.owner)then\n        chainhelper:transfer_from_owner(to,amount,symbol,true)  --[[Transfer the tokens out]]\n    end\n    write_list=read_list\n    chainhelper:write_chain()\nend\n\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.5. Generate/verify hash**
[block:code]
{
  "codes": [
    {
      "code": "function set_hash(source) \n    public_data.hash256=chainhelper:hash256(source) \n    public_data.hash512=chainhelper:hash512(source) \n    chainhelper:write_chain() --Default: write_list={public_data={},private_data={}}, update all data, this contract has two data of hash256 and hash512 \nend \nfunction check_hash(source) \n    chainhelper:read_chain() --Default: read_list={public_data={},private_data={}}, load all data, this contract has two data of hash256 and hash512 \n    assert(public_data.hash256==chainhelper:hash256(source),'hash256 check error') \n    assert(public_data.hash512==chainhelper:hash512(source),'hash512 check error') \nend\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.6. Modify non-homogeneous asset description data**
[block:code]
{
  "codes": [
    {
      "code": "--Modify non-homogeneous asset descriptions with json strings\nfunction my_nht_describe_change( nht_hash_or_id,values_json) \n    local values=cjson.decode(values_json) \n    for key,value in pairs(values)  do  \n        chainhelper:log('key:'..key..',value:'..value)   \n        chainhelper:nht_describe_change( nht_hash_or_id,key,value,true)  \n    end  \nend\n\n--Modify non-homogeneous asset descriptions in lua form\nfunction nht_change_with_table( nht_hash_or_id,values_table) \n    for key,value in pairs(values_table)  do  \n        chainhelper:log('key:'..key..',value:'..value)   \n        chainhelper:nht_describe_change( nht_hash_or_id,key,value,true)  \n    end  \nend",
      "language": "lua"
    }
  ]
}
[/block]
**5.7. Example of random function**
[block:code]
{
  "codes": [
    {
      "code": "--This example is a function of accumulating 10 randomness and outputting the result.\nfunction sum_public_by_rand()\n    read_list={public_data={sum_rand_10=true}}\nchainhelper:read_chain()\n--Interface caller permissions can be qualified by assertion in combination with the is_owner function\n    assert(chainhelper:is_owner(),'You`re not the contract`s owner')\n    local i=0\n    while(i<10)do\n        i=i+1\n        if(public_data.sum_rand_10==nil)then\n            public_data.sum_rand_10=0\n            public_data.sum_rand_10=public_data.sum_rand_10+chainhelper:random()%100\n--The value of % after random() is the range of values that need to be random. For example, the random result in this example is 0~99.\n        else\n            public_data.sum_rand_10=public_data.sum_rand_10+chainhelper:random()%100\n        end\n    end\n    write_list={public_data={sum_rand_10=true}}\n    chainhelper:write_chain()\n    chainhelper:log('date:'..date('%Y-%m-%dT%H:%M:%S', chainhelper:time())..',sum:'..public_data.sum_rand_10) end\nend\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.8. Lottery game**
[block:code]
{
  "codes": [
    {
      "code": "--Set prize pool\nfunction set_ticket(ticket)                \n  assert(chainhelper:is_owner(),'You`re not the contract`s owner')            \n  read_list={public_data={ticket_pool_1=true,ticket_pool_2=true}}  \n  chainhelper:read_chain()  \n  if(public_data.ticket_pool_1==nil)then \n      public_data.ticket_pool_1={}  \n    public_data.ticket_pool_2={}  \n    if (public_data.ticket_pool_1[ticket]==nil) then            \n        public_data.ticket_pool_2[#public_data.ticket_pool_2+1]=ticket  \n        public_data.ticket_pool_1[ticket]=#public_data.ticket_pool_2  \n    end     \n  else\n    if (public_data.ticket_pool_1[ticket]==nil) then  \n        public_data.ticket_pool_2[#public_data.ticket_pool_2+1]=ticket  \n        public_data.ticket_pool_1[ticket]=#public_data.ticket_pool_2  \n    end     \n  end\n  assert(#public_data.ticket_pool_2<=12)\n  write_list={public_data={ticket_pool_1={[ticket]=true},ticket_pool_2={[#public_data.ticket_pool_2]=true}}}  \n  chainhelper:write_chain()  \n  end\n\n--Draw a lottery\nfunction luck_draw(ticket,amount,asset)  \n  assert(amount>=1000000,'amount should not be less than 1000000')  \n  assert(asset=='COCOS','asset error')  \n  read_list={public_data={ticket_pool_1=true,ticket_pool_2=true}}  \n  chainhelper:read_chain()      \n  local total=chainhelper:get_account_balance(contract_base_info.owner,asset)      \n  assert((#public_data.ticket_pool_2)*amount<=total,'Current maximum compensation ratio:'..#public_data.ticket_pool_2..'The biggest bet at present:'..total/(#public_data.ticket_pool_2))  \n  chainhelper:transfer_from_caller(contract_base_info.owner,amount,asset,true)  \n  local index=chainhelper:random()%(#public_data.ticket_pool_2)+1      \n  local rate = chainhelper:random()%(#public_data.ticket_pool_2)+1\n  chainhelper:log('luck:'..public_data.ticket_pool_2[index]..',rate:'..rate)\n  if(public_data.ticket_pool_2[index]==ticket)then  \n    chainhelper:transfer_from_owner(contract_base_info.caller,rate*amount,asset,true)      \n  end\n end\n --Reset the prize pool\nfunction reset_ticket() \n    write_list_list={public_data={ticket_pool_1=false,ticket_pool_2=false}}\n    chainhelper:write_chain()\nend \n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.9. Example 1: set the prize pool**
[block:code]
{
  "codes": [
    {
      "code": "function set_ticket(ticket)\nassert(is_owner(),'You`re not the contract`s owner')\n    if(public_data.ticket_pool_1==nil)then\n        public_data.ticket_pool_1={}\n        public_data.ticket_pool_2={}\n        if (public_data.ticket_pool_1[ticket]==nil) then\n            public_data.ticket_pool_2[#public_data.ticket_pool_2+1]=ticket --Note: the lua array subscript starts with 1\n            public_data.ticket_pool_1[ticket]=#public_data.ticket_pool_2\n        end\n    else\n        if (public_data.ticket_pool_1[ticket]==nil) then\n            public_data.ticket_pool_2[#public_data.ticket_pool_2+1]=ticket\n            public_data.ticket_pool_1[ticket]=#public_data.ticket_pool_2\n        end\n    end\nend\n--Lottery, ticket: lots, amount: token amount，asset: token type\nfunction luck_draw(ticket,amount,asset)\n    assert(amount>=1000000,'amount should not be less than 1000000')\n    assert(asset=='COCOS','asset error')\nlocal total=get_account_balance(contract_base_info.owner,asset)\nassert((#public_data.ticket_pool_2)*amount<=total,'Current maximum compensation ratio:'..#public_data.ticket_pool_2..'The biggest bet at present:'..total/(#public_data.ticket_pool_2))\n    transfer_from_caller(contract_base_info.owner,amount,asset,true)\n    local index=random()%(#public_data.ticket_pool_2)+1  --Note: the lua array subscript starts with 1\nlocal rate=0\n    if(public_data.ticket_pool_2[index]==ticket)then\n        while(true)do\nrate =random()%(#public_data.ticket_pool_2)\nif(rate*amount<=total) then\ntransfer_from_owner(contract_base_info.caller,rate*amount,asset,true)\nbreak\nend\nend\n    end\nlog('ticket:'..public_data.ticket_pool_2[index]..',rate:'..rate)\nend\n--Random accumulation function for verifying random numbers on the chain (for testing)\nfunction sum_public_by_rand()\nassert(is_owner(),'You`re not the contract`s owner')\n    local i=0\n    while(i<10)do\n    i=i+1\n        if(public_data.sum_rand_10==nil)then\n            public_data.sum_rand_10=0\n          public_data.sum_rand_10=public_data.sum_rand_10+random()%100\n        else\n            public_data.sum_rand_10=public_data.sum_rand_10+random()%100\n        end\n    end\nend\n\n",
      "language": "lua"
    }
  ]
}
[/block]
**5.10. Example 2: Modify the contract-related description of the non-homogeneous token, and the part to be modified is the ​corresponding area of the contract.**
[block:code]
{
  "codes": [
    {
      "code": "function my_nht_describe_change( nht_hash_or_id,change_values_json)\nlocal change_values=cjson.decode(change_values_json)--Note: here is the use of the cjson module\nfor key,value in pairs(change_values) do--Note: traversal of lua table, distinguishing between ipairs and pairs\nlog('key:'..key..',value:'..value)\nnht_describe_change( nht_hash_or_id,key,value,true)\nend\nend\n//nht_hash_or_id：Non-homogeneous token hash or id\n//change_values_json：Specified modification content in json format for batch modification\nModify contract verification permissions\n\nfunction my_change_contract_authority(publickey)\nassert(is_owner(),'You`re not the contract`s owner')\n    change_contract_authority(publickey)\nend\n--Set contract authority verification ID to enable or disable contract signing requirements. Only the corresponding trusted execution environment has contract authority.\n\nfunction set_permissions_flag(flag)\n    assert(is_owner(),'You`re not the contract`s owner')\n    set_permissions_flag(flag)\nend\n--Encrypted data constructor\nfunction my_make_memo(to,key,value) make_memo(to,key,value,true) end\n\n",
      "language": "lua"
    }
  ]
}
[/block]