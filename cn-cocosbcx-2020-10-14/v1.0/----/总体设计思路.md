---
title: "总体设计思路"
slug: "总体设计思路"
excerpt: "本章主要为您介绍 Cocos-BCX 项目业务与运行设计，能帮您快速了解整体项目的基本情况。"
hidden: false
createdAt: "2018-12-14T08:36:51.500Z"
updatedAt: "2018-12-21T08:11:39.391Z"
---
[block:api-header]
{
  "title": "钱包和区块链浏览器"
}
[/block]
Cocos-BCX项目向多种运行平台提供数字资产钱包，包括 Android、iOS及Windows等操作系统， 确保主流运行环境下的用户均可以参与资产流转。通过数字资产钱包，用户可以将所有的游戏数字资产和通过承兑网关导入的ERC20资产存储在其中，更加方便在游戏金币流通平台完成出让和购入。 另一方面，Cocos-BCX 对数字资产钱包进行了金融级别的算法加密，同时会结合运行平台的 KYC 认证 服务，确保用户存储在钱包中的数字财产安全。
 
Cocos-BCX 在钱包中直接提供区块链浏览器功能。区块链浏览器是浏览区块链信息的主要窗口，每一个区块所记载的内容都可以从区块链浏览器上进行查阅。每一个独立的区块链系统都有对应的区块链浏览器。Cocos-BCX 提供一个完整的、带有查询和跳转功能的区块链浏览器，例如当用户在游戏中产出一件珍惜级别的道具资产时，对应的游戏道具数据就会在主链中产生，用户可在区块链浏览器中查询到对应的事务信息，Cocos-BCX 的区块链浏览器支持原子操作的查阅。区块链浏览器可以让用户更加透明的了解自己的资产分布，所有的数据在链上记录，真实不可篡改。
[block:api-header]
{
  "title": "可迭代的智能合约系统"
}
[/block]
以 Ethereum 为代表的智能合约体系，其智能合约一旦定义发布后就无法再修改，难以满足链上游戏逻辑更新、漏洞修复对合约系统的需求，因此我们在设计合约系统时针对游戏合约需要更新、 漏洞修补等场景的需求做出了可迭代更新的合约系统设计。
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/efaa7f8-12.png",
        "12.png",
        1467,
        581,
        "#9fc5ce"
      ],
      "caption": "智能合约迭代更新"
    }
  ]
}
[/block]
当合约开发者将定义的合约发布至链网络后，系统允许具备此合约开发者权限的用户使用修改后的合约更新此合约，虽然旧的合约仍然存在（确保合约的公开和公正性），但链上的合约地址的内容将被新的合约数据覆盖，多合约应用无需更新引用关系。
[block:api-header]
{
  "title": "游戏世界观"
}
[/block]
区块链游戏的世界观是一种用于区分游戏故事设定、角色/道具/规则设定和效用范围的标识。
与传统游戏行业的概念不同，COCOS-BCX中运行的区块链游戏并非完全相互独立的业务场景，每一个游戏即一个世界，而数个具有相似基本设定的游戏世界按照一定的交流、联动模式产生关联，即可以认为这几个游戏世界拥有一个共同的世界观。

世界观这一概念并非区块链游戏首创，现代游戏行业已经有许多游戏具备了这一特性，例如《魔兽争霸》、《魔兽世界》、《炉石传说》、《风暴传说》拥有共同的暴雪宇宙世界观，其中有相当部分的游戏道具、角色、资产是共通的，虽然这些资产在各自的游戏中有不同的具体属性、技能等解释，但这些资产的设计基础源于共同的基本规则。

区块链游戏的世界观是一种用于区分游戏故事设定、角色/道具/规则设定和效用范围的标识。游戏道具在世界观中遵循统一的世界规范，能够通过支付迁移费用在本世界观下的不同游戏世界中迁移，即游戏道具的“穿越”。

Cocos-BCX 允许游戏开发者在创世时声明世界观，允许世界观有自己的治理委员会（和共识委员会），未来还将允许世界观具备自己独立的链环境。

[block:api-header]
{
  "title": "游戏道具“穿越”世界"
}
[/block]
世界观相同的游戏资产和道具可以在本世界观下的不同游戏世界中互通，如下图中的游戏 B 的道具，可以进入游戏 A 与游戏 C 的世界中进行使用。
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/5cc8efd-14.png",
        "14.png",
        326,
        349,
        "#f5f7f9"
      ],
      "caption": "支持相同或相似世界观的不同游戏道具流通"
    }
  ]
}
[/block]
游戏道具在世界观遵循统一的世界规范，能够通过支付迁移费用在本世界观下的不同游戏世界中迁移，即游戏道具的“穿越” ；道具是一种用于链上游戏的非同质数字资产，道具的“穿越”即同一世界观下的资产在不同游戏应用的过程；不同游戏对该资产的修改会存储在游戏各自的域数据中，游戏间的数据在默认的设置下互不干涉，能且仅能修改自己的域数据。
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/1bcae60-15.png",
        "15.png",
        618,
        470,
        "#ada59e"
      ],
      "caption": "一个链上游戏资产在世界观内不同游戏世界中迁移的示例"
    }
  ]
}
[/block]

[block:api-header]
{
  "title": "铁匠铺机制"
}
[/block]
“铁匠铺”的本质是一系列具有道具、装备制作权限的帐号和一系列合约，作为所有游戏世界的核心功能之一，铁匠铺可由游戏厂商管理，亦可由玩家公会、设计师工作室经营。玩家可通过铁匠铺，将金币和材料合成为道具（或直接求购[h1] 道具）。铁匠铺创造道具的过程公开透明，与游戏中的其他道具一样具有唯一性，能够从区块链浏览器中检索和查询。铁匠铺锻造资产及资产流通。
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/5a5bce2-16.png",
        "16.png",
        545,
        262,
        "#f8f8f8"
      ],
      "caption": "铁匠铺锻造资产及资产流通"
    }
  ]
}
[/block]
铁匠铺机制中，合并多个道具操作为一个原子操作，以确保事务的原子性，事务中的所有操作只会同时成功或同时失败。此外，在“玩家-铁匠铺-玩家”的整个过程中，核心部分包含：玩家提交素材给铁匠铺，铁匠铺将制作完成的游戏道具交给玩家，两者合起来可视为一个完整的事务。两步行为信息都将在链上存在，确保用户的资产流转信息真实可靠不可篡改，保证玩家发布流通的材料、游戏金币等数字资产不会像以往中心化的游戏系统一样出现暗箱操控，数据丢失等情况，能够切实保护玩家利益。

铁匠铺拥有以下特性：
  * 具有道具、装备制作权限的帐号和一组合约；
  * 铁匠铺是独立于游戏的道具产出点；
  * 铁匠铺的道具具有唯一性；
  * 道具生成、设置道具属性、变更道具所有权到用户等合并为一个原子操作；
  * 铁匠铺由世界观管委会（厂商、玩家公会、设计师联盟）管理。
Cocos-BCX 允许向铁匠铺授权世界观下的道具产出权限。例如胜利与誓约之剑，可以有亚瑟传奇世界观的版本，亦可以有 TYPE MOON 世界观的版本，两者可在各自的世界中跨作品流通，使用统一的世界观的同质资产进行该世界观下的资产流通标准。

[block:api-header]
{
  "title": "道具嵌套组合"
}
[/block]
游戏中装备道具可能是由多个组件、物品组合而成的，Cocos-BCX 设计中，区块链游戏的非同质数字资产，即道具也具备能够嵌套包含的特性。
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/115b9b8-17.png",
        "17.png",
        374,
        386,
        "#f6f6f7"
      ],
      "caption": "道具嵌套"
    }
  ]
}
[/block]
每一个道具都可以由多个道具组成，父级资产可以包含一个或多个子级资产，子级资产又可以包含其他的子级资产，如图中的道具“红色彗星”由子级道具“引擎”、“机轮”、“武 器”组成，而子级道具“引擎”和“机轮”又分别由子级道具“燃油”、“滤清器”和“齿轮”、 “轮胎”组成。
[block:api-header]
{
  "title": "道具资产流通平台"
}
[/block]
Cocos-BCX 项目中，道具买卖主要由两个函数实现：道具的求购是一个多步合成的原子操作，在支付费用的同时完成用户账户游戏道具数据的更新，如果当中任一个动作不被主链区块认可，则整个事务将被回滚。

 对于道具的出让，Cocos-BCX 提供的函数并不能直接变更特定资产的所有权，而是向 OTC 资产流通平台（中心或去中心）发起出让资产的请求。原则上讲，链内只允许用户对自己的资产发起主动操作，而不应被任何第三方控制，例如平台对实际资产的托管、代管出让。OTC 资产流通平台需记录本函数执行成功时生成的 orderObejct 请求对象。（在发起前可调用 getItems 函数，列出用户道具，以便用户选择出让）当求购请求抵达时，实质是请求的点对点匹配。

与传统的游戏交易平台不同，Cocos-BCX 的去中心数字资产流通平台并不存在中介机构，一方面提高了双方完成流通的效率，一方面能够让原本支付给中介机构的费用直接支付给了卖方，达到卖家多获益、买家少消耗的效果。

玩家可以在道具流通平台完成“游戏金币”和游戏中道具资产等非同质资产的出让和求购行为。在整个流转过程中，为了更加高效的帮助用户完成流转服务，平台将采用智能合约进行自动撮合。
流通平台将对接多平台运行的游戏数据，由于具备最佳的兼容性和可定制特性，游戏厂商可以灵活设计自己的链上游戏存储结构，并将游戏数据对接到流通平台，用户可以方便的在流通平台查询到多种游戏的金币和道具资产。

用户在授权登录流通平台后，可以选择将自己的游戏道具资产以请求的方式提交至流通平台，符合要求的购入请求和出让请求将被系统自动撮合，内容不局限于游戏内货币等同质资产，也涵盖道具、装备、游戏数据等非同质资产。

完成发布请求后，请求信息将被写入链上。游戏内对应的资产也将被同时冻结。 一个典型的资产流转过程 如下图所示：

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/239ce60-111.png",
        "111.png",
        665,
        44,
        "#9ac8f3"
      ],
      "caption": "数字资产流转过程"
    }
  ]
}
[/block]

[block:api-header]
{
  "title": "玩家自治和资产安全"
}
[/block]
Cocos-BCX 公开节点工具包，游戏开发商、运营商、玩家公会、设计师工作室等均可成为节点，并参与理事节点选举。

由于区块链网络公开、透明的特性，玩家在游戏中所获得的数字资产信息可以通过区块链浏览器被任何人查阅到。而在游戏世界中，拥有高价值非同质资产的帐号往往会成为盗号者、黑客勒索的首选目标。Cocos-BCX 对玩家账号的资产安全非常重视，针对游戏资产安全提供以下安全保障机制：
  * 操作权限制：游戏内道具所有权及处置权仅归玩家所有，物品销毁的操作仅能由用户自己授权处理；
  * 关键操作原子化：发生资产流通、资产创建等重要行为时，请求被提交至流通平台或铁匠铺，在完成流通或制作的过程中的所有操作被视为一次不可分割的原子事务，即这些过程中的参与行为均需被同时共识认可才被视为通过，如果其中任意一个操作不被链网络认可，则整个操作过程将被回滚，避免发生异常的事务过程；
  * 可扩展的多步验证：除去区块链事务验证密码以外，游戏商提供进一步的二次密码验证以及随机码验证等，进一步提高玩家资产安全性。

[block:api-header]
{
  "title": "关于分布式记账体系"
}
[/block]
在上文中我们提到链上游戏的最终形态是实现游戏整体逻辑的上链运行，但现有的区块链技术尚不满足承载游戏完整逻辑所必须的最低限度特性，其中最为关键的几点包括：

**节点数据同步的数据量与时间成本**
只有完整节点具备执行合约的能力，但完整节点存储有全网的所有事务数据，其数据量之大显而易见，且新建一个节点时同步这些数据的时间消耗也非常惊人；

**游戏逻辑完整上链需要能够支持大型合约**
若实现游戏完整逻辑上链，那么合约本身将包含游戏的全部后台逻辑，合约将可能变得非常大，甚至超过一般区块的块大小，而在现有区块链技术的设计下，无法被块容纳的合约是永远无法运行并得出结果的；

**合约持续执行**
游戏逻辑完整上链则意味着一个游戏应用在结束前，游戏合约将会持续运行，也即是游戏合约的运行时间是远大于出块周期，跨块执行的，现有任何区块链技术都无法支持这样的合约运行模式；

**事务执行延迟**
游戏完整上链意味着链上处理了所有游戏中可能会执行的事务，其中不乏要求高速响应的部分，而传统区块链的事务响应取决于出块行为，而最快确认速度也受限于出块周期限制，难以满足游戏合约对事务即时响应的需求。

**随机过程无法共识**
链上随机过程规则由智能合约描述，而合约的过程是公开的，若需要产生无法被第三方推算的随机结果，则需要合约运行时有节点的噪声参与这一过程的输入，但不同节点的噪声不可能一致，即其他节点无法通过再次运行这份合约来验证这次随机过程的结果是否正确，最终导致无法完成共识。

**链内实现的定时器与心跳**
定时器与心跳机制是所有链上合约、游戏内容实现定时运行、自动运行、条件运行的前提条件，而这一特性的时候背后还隐含了时间同步、同步防伪等过程，这对现有区块链技术来说是完全空白的区域。

**数字资产权限**
传统区块链数字资产记录在合约数据区域内，资产不能脱离合约，因此合约所有者有权修改数字资产数据，可能导致资产拥有者受到损失。

针对这些问题，Cocos-BCX提出了对现有的分布式记账体系进行深度改造的设想，提出了下述的多种特性、机制设计，以最终实现链上游戏能够具备实际落地运行的目标：
  * 减少数据量和时间成本；
  * 在语法级别支持共识任务；
  * 合约持续执行；
  * 极小的事务延迟执行；
  * 链内可信随机过程；
  * 链内实现定时器与心跳；
  * 非同质数字资产数据结构中增加权限观念；